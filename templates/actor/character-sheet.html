<form class="{{cssClass}} flexcol" autocomplete="off">
  {{!-- Sheet Header --}}
  <header class="sheet-header">
    <div class="header-col1">
      <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" />
    </div>
    <div class="header-col2">

      <div class="header-title-row">
        <input class="actor-name" name="name" type="text" value="{{actor.name}}" placeholder="{{ localize 'PB.Name' }}" spellcheck="false" />
      </div>

      <div class="header-subtitle-row">
        <div class="actor-type">
          <span class="item-edit rollable item-class">{{data.data.dynamic.class.name}}</span>         
          {{#if data.data.dynamic.baseClass }}
          - <span class="item-edit rollable item-base-class">{{data.data.dynamic.baseClass.name}}</span>
          {{/if}}
        </div>
      </div>

      <div class="header-stats-row">
        <div class="stats-block">
          <span class="stat-label">{{ localize "PB.HP" }}</span>
          <input class="stat-input" name="data.attributes.hp.value" type="number" value="{{data.data.attributes.hp.value}}" data-dtype="Number" />
          <span class="stat-separator">/</span>
          <input class="stat-input" name="data.attributes.hp.max" type="number" value="{{data.data.attributes.hp.max}}" data-dtype="Number" />
        </div>
      </div>
      
      <div class="header-stats-row">
        <div class="stats-block">
          <span class="stat-label luck-label rollable">{{ localize "PB.Luck" }}</span>
          <input class="stat-input" name="data.attributes.luck.value" type="number" value="{{data.data.attributes.luck.value}}" data-dtype="Number" />
          <span class="stat-rule luck-rule rollable">({{data.data.dynamic.luckDie}} {{ localize "PB.PerRest"}})</span>  
        </div>        
      </div>

      <div class="header-buttons-row">
        <button type="button" class="button item-button broken-button rollable" title="{{localize 'PB.Broken'}}">{{localize 'PB.Broken'}}</button>
        <button type="button" class="button item-button rest-button rollable" title="{{localize 'PB.Rest'}}">{{localize 'PB.Rest'}}</button>
        <button type="button" class="button item-button get-better-button rollable" title="{{localize 'PB.GetBetter'}}">{{localize 'PB.GetBetter'}}</button>
      </div>
    </div>

    <div class="header-col3">
      <div class="ability-row">
        <input
          class="ability-input"
          type="text"
          name="data.abilities.strength.value"
          value="{{numberFormat data.data.abilities.strength.value decimals=0 sign=true}}"
          data-dtype="Number"
          size="3"
        />
        <span class="ability-label rollable strength">{{ localize 'PB.AbilityStrength' }}</span>
      </div>
      <div class="ability-row">
        <input
          class="ability-input"
          type="text"
          name="data.abilities.agility.value"
          value="{{numberFormat data.data.abilities.agility.value decimals=0 sign=true}}"
          data-dtype="Number"
          size="3"
        />
        <span class="ability-label rollable agility">{{ localize 'PB.AbilityAgility' }}</span>
      </div>
      <div class="ability-row">
        <input
          class="ability-input"
          type="text"
          name="data.abilities.presence.value"
          value="{{numberFormat data.data.abilities.presence.value decimals=0 sign=true}}"
          data-dtype="Number"
          size="3"
        />
        <span class="ability-label rollable presence">{{ localize 'PB.AbilityPresence' }}</span>
      </div>
      <div class="ability-row">
        <input
          class="ability-input"
          type="text"
          name="data.abilities.toughness.value"
          value="{{numberFormat data.data.abilities.toughness.value decimals=0 sign=true}}"
          data-dtype="Number"
          size="3"
        />
        <span class="ability-label rollable toughness">{{ localize 'PB.AbilityToughness' }}</span>
      </div>
      <div class="ability-row">
        <input
          class="ability-input"
          type="text"
          name="data.abilities.spirit.value"
          value="{{numberFormat data.data.abilities.spirit.value decimals=0 sign=true}}"
          data-dtype="Number"
          size="3"
        />
        <span class="ability-label rollable spirit">{{ localize 'PB.AbilitySpirit' }}</span>
      </div>
    </div>
  </header>

  {{!-- Sheet Tab Navigation --}}
  <nav class="sheet-tabs tabs" data-group="primary">
    <span class="spacer"></span>
    <a class="item" data-tab="combat">{{ localize 'PB.TabCombat' }}</a>
    <a class="item" data-tab="powers">{{ localize 'PB.Powers' }}</a>
    <a class="item" data-tab="equipment">{{ localize 'PB.TabEquipment' }}</a>
    <a class="item" data-tab="features">{{ localize 'PB.TabFeatures' }}</a>
    <a class="item" data-tab="history">{{ localize 'PB.TabHistory' }}</a>
    <span class="spacer"></span>
  </nav>

  {{!-- Sheet Body --}}
  <section class="sheet-body">
    {{!-- History Tab --}}
    <div class="tab class-tab" data-group="primary" data-tab="history">
      {{editor content=data.data.description target="data.description" button=true owner=owner editable=true}}
    </div>

    {{!-- Combat Tab --}}
    <div class="tab combat-tab" data-group="primary" data-tab="combat">
      {{!-- Initiative buttons --}}
      <ol class="items-list inventory-list">
        <li class="items-header flexrow">
          <h3 class="item-name flexrow">{{localize "PB.Initiative"}}</h3>
        </li>
        <ol class="item-list">
          <li class="item flexrow">
            <h4 class="item-name item-edit rollable"></h4>
            <div class="item-buttons">
              <button type="button" class="button item-button rollable initiative-button party-initiative-button" title="{{localize 'PB.Party'}}">
                {{localize "PB.Party"}}
              </button>
            </div>
            <div class="item-buttons">
              <button type="button" class="button item-button rollable initiative-button individual-initiative-button" title="{{localize 'PB.Individual'}}">
                {{localize "PB.Individual"}}
              </button>
            </div>
          </li>
        </ol>
      </ol>

      {{!-- Weapons --}}
      <ol class="items-list inventory-list">
        <li class="items-header flexrow">
          <h3 class="item-name flexrow">{{localize "PB.ItemTypeWeaponPlural"}}</h3>
        </li>
        <ol class="item-list weapon-list">
          {{#each data.data.dynamic.equippedWeapons as |item id|}}
          <li class="item flexrow" data-item-id="{{item._id}}">
            <img src="{{item.img}}" title="{{item.name}}" width="24" height="24" />
            <div class="weapon-name-col">
              <h4 class="item-name item-edit rollable">{{item.name}}</h4>
              {{#if ../data.data.dynamic.trackAmmo}} {{#if item.data.usesAmmo}}
              <div class="ammo-select-col">                
                <select class="ammo-select" name="selectedAmmo-{{item._id}}" data-dtype="Number" data-item-id="{{item._id}}">
                  {{#select item.data.ammoId}}
                  <option value=""><span class="ammo-label">{{localize 'PB.SelectAmmo'}} </span></option>
                  {{#each ../data.data.dynamic.ammo as |ammo ammoId|}}
                  <option value="{{ammo._id}}">{{ammo.name}} ({{ammo.data.quantity}})</option>
                  {{/each}} {{/select}}
                </select>
              </div>
              {{/if}} {{/if}}
            </div>
            <div class="item-fields">
              <span class="item-field damage-die">{{item.data.damageDie}}</span>
              <span class="item-field weapon-type">{{item.data.weaponType}}</span>
            </div>
            <div class="item-buttons">
              {{#if item.data.loadingCount}}
              <button
                      type="button"
                      class="item-button reload-button button"
                      data-label="reload_{{item._id}}"
                      title="{{localize 'PB.Attack'}}"
              >
                {{localize 'PB.Reload'}} {{#if item.data.reloadTime}}({{item.data.loadingStatus}}/{{item.data.reloadTime}}){{/if}}
              </button>
              {{else}}
              <button
                      type="button"
                      class="item-button rollable attack-button button"
                      data-roll="d20+@abilities.strength.value"
                      data-label="attack_{{item._id}}"
                      title="{{localize 'PB.Attack'}}"
              >
                {{localize 'PB.Attack'}}
              </button>
              {{/if}}
            </div>
            <div class="item-controls">
              <a
                class="item-control item-toggle item-toggle-equipped {{ifPrint item.data.equipped 'equipped'}}"
                title="{{ifPrintElse item.data.equipped (localize 'PB.ItemEquipped') (localize 'PB.ItemUnequipped')}}"
                ><i class="fas fa-fist-raised"></i
              ></a>
              <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
            </div>
          </li>
          {{/each}} {{#unless data.data.dynamic.equippedWeapons.length}}
          <li class="item flexrow empty-container">
            <div class="rule-text you-have-no">{{localize 'PB.EquipAWeaponToAttack'}}</div>
          </li>
          {{/unless}}
        </ol>
      </ol>

      {{!-- Armor --}}
      <ol class="items-list inventory-list">
        <li class="items-header flexrow">
          <h3 class="item-name flexrow">{{localize "PB.ItemTypeArmorPlural"}}</h3>
        </li>
        <ol class="item-list armor-list">
          {{#if data.data.dynamic.equippedArmor}}
          <li class="item flexrow" data-item-id="{{data.data.dynamic.equippedArmor._id}}">
            <img src="{{data.data.dynamic.equippedArmor.img}}" title="{{data.dynamic.equippedArmor.name}}" width="24" height="24" />
            <h4 class="item-name item-edit rollable">{{data.data.dynamic.equippedArmor.name}}</h4>
            <div class="item-armor-tier">
              <label class="stat-label tier-label">{{ localize "PB.Tier" }}</label>
              <ul class="tiers">
                <li>
                  <label>
                    <input class="tier-radio" type="radio" name="tier.value" value="0" {{#ifEq data.data.dynamic.equippedArmor.data.tier.value 0}}checked{{/ifEq}} />
                    <span class="tier-num">0</span>
                    <span class="tier-dmg">-0</span>
                  </label>
                </li>
                <li>
                  <label>
                    <input class="tier-radio" type="radio" name="tier.value" value="1" {{#ifLt data.data.dynamic.equippedArmor.data.tier.max 1}}disabled{{/ifLt}} {{#ifEq data.data.dynamic.equippedArmor.data.tier.value 1}}checked{{/ifEq}} />
                    <span class="tier-num">1</span>
                    <span class="tier-dmg">-d2</span>
                  </label>
                </li>
                <li>
                  <label
                    ><input class="tier-radio" type="radio" name="tier.value" value="2" {{#ifLt data.data.dynamic.equippedArmor.data.tier.max 2}}disabled{{/ifLt}} {{#ifEq data.data.dynamic.equippedArmor.data.tier.value 2}}checked{{/ifEq}} />
                    <span class="tier-num">2</span>
                    <span class="tier-dmg">-d4</span>
                  </label>
                </li>
                <li>
                  <label
                    ><input class="tier-radio" type="radio" name="tier.value" value="3" {{#ifLt data.data.dynamic.equippedArmor.data.tier.max 3}}disabled{{/ifLt}} {{#ifEq data.data.dynamic.equippedArmor.data.tier.value 3}}checked{{/ifEq}} />
                    <span class="tier-num">3</span>
                    <span class="tier-dmg">-d6</span>
                  </label>
                </li>
              </ul>
            </div>
            <div class="item-controls">
              <a
                class="item-control item-toggle item-toggle-equipped {{ifPrint data.data.dynamic.equippedArmor.data.equipped 'equipped'}}"
                title="{{ifPrintElse data.data.dynamic.equippedArmor.data.equipped (localize 'PB.ItemEquipped') (localize 'PB.ItemUnequipped')}}"
                ><i class="fas fa-fist-raised"></i
              ></a>
              <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
            </div>
          </li>
          {{/if}} 
          {{#if data.data.dynamic.equippedHat}}
          <li class="item flexrow" data-item-id="{{data.data.dynamic.equippedHat._id}}">
            <img src="{{data.data.dynamic.equippedHat.img}}" title="{{data.data.dynamic.equippedHat.name}}" width="24" height="24" />
            <h4 class="item-name item-edit rollable">{{data.data.dynamic.equippedHat.name}}</h4>
            <div class="item-hat-rule">
              <span class="rule-text hat-rule"> {{data.data.dynamic.equippedHat.data.ruleText}}</span>
            </div>
            <div class="item-controls">
              <a
                class="item-control item-toggle item-toggle-equipped {{ifPrint data.data.dynamic.equippedHat.data.equipped 'equipped'}}"
                title="{{ifPrintElse data.data.dynamic.equippedHat.data.equipped (localize 'PB.ItemEquipped') (localize 'PB.ItemUnequipped')}}"
                ><i class="fas fa-fist-raised"></i
              ></a>
              <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
            </div>
          </li>
          {{/if}} 
          {{#unless data.data.dynamic.equippedArmor }} 
            {{#unless data.data.dynamic.equippedHat}}
              <li class="item flexrow empty-container">
                <div class="rule-text you-have-no">{{localize 'PB.EquipArmorToAbsorb'}}</div>
              </li>
            {{/unless}}
          {{/unless}}
        </ol>
      </ol>

      <div class="underarmor-row">
        <div class="incoming-attack">
          <div>
            <button type="button" class="item-button rollable defend-button button" title="{{localize 'PB.Defend'}}">{{localize "PB.Defend"}}</button>
          </div>
        </div>
      </div>
    </div>

    {{!-- Features Tab --}}
    <div class="tab specials-tab" data-group="primary" data-tab="features">
      {{#if data.data.dynamic.useExtraResource}}
      <div class="powers-top-row">
        <div class="stats-block">
          <label class="stat-label uses-remaining-label">{{ data.data.dynamic.extraResourceNamePlural }}</label>
          <input class="stat-input" name="data.attributes.extraResource.value" type="number" value="{{data.data.attributes.extraResource.value}}" data-dtype="Number" />
          <span class="stat-rule rollable extra-resources-per-day-text">{{ data.data.dynamic.extraResourceFormulaLabel }}</span>
        </div>
      </div>
      {{/if}} 
      {{#each data.data.dynamic.features as |item id|}}
        <ol class="items-list inventory-list">
          <li class="items-header flexrow">
            <h3 class="item-name flexrow">{{item.type}}</h3>
          </li>
          <ol class="item-list">
            {{#each item.items as |item id|}}
            <li class="item flexrow" data-item-id="{{item._id}}">
              <img src="{{item.img}}" title="{{item.name}}" width="24" height="24" />
              <h4 class="item-name item-edit rollable">{{item.name}} {{#ifGt item.data.quantity 1}} ({{item.data.quantity}}) {{/ifGt}}</h4>
              <div class="item-buttons">{{> "systems/pirateborg/templates/actor/common/actor-item-button.html" item=item}}</div>
              <div class="item-controls">
                <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
              </div>
            </li>
            {{/each}}
          </ol>
        </ol>
      {{/each}} 
      {{#unless data.data.dynamic.features.length}}
        <ol class="items-list inventory-list">
          <ol class="item-list weapon-list">
            <li class="item flexrow empty-container">
              <div class="rule-text you-have-no">{{localize 'PB.YouHaveNoFeatures'}}</div>
            </li>
          </ol>
        </ol>
      {{/unless}}
    </div>

    {{!-- Powers Tab --}}
    <div class="tab powers-tab" data-group="primary" data-tab="powers">
      <div class="powers-top-row">
        <div class="stats-block">
          <label class="stat-label uses-remaining-label">{{localize "PB.RitualRemaining"}}</label>
          <input class="stat-input" name="data.attributes.rituals.value" type="number" value="{{data.data.attributes.rituals.value}}" data-dtype="Number" />
          <span class="stat-rule rollable ritual-per-day-text">{{localize "PB.RitualPerday"}}</span>
        </div>
      </div>

      {{#each data.data.dynamic.invokables as |group|}}
      <ol class="items-list inventory-list">
        <li class="items-header flexrow">
          <h3 class="item-name flexrow">{{ group.type }}</h3>
          <div class="item-controls flexrow"></div>
        </li>
        <ol class="item-list">
          {{#each group.items as |item id|}}
          <li class="item flexrow" data-item-id="{{item._id}}">
            <img src="{{item.img}}" title="{{item.name}}" width="24" height="24" />
            <h4 class="item-name item-edit rollable">{{item.name}}</h4>
            <div class="item-buttons">{{> "systems/pirateborg/templates/actor/common/actor-item-button.html" item=item}}</div>
            <div class="item-controls">
              <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
            </div>
          </li>
          {{/each}}
        </ol>
      </ol>
      {{/each}} {{#unless data.data.dynamic.invokables.length}}
      <ol class="items-list inventory-list">
        <ol class="item-list weapon-list">
          <li class="item flexrow empty-container">
            <div class="rule-text you-have-no">{{localize 'PB.YouHaveNoUsableItems'}}</div>
          </li>
        </ol>
      </ol>
      {{/unless}}
    </div>

    {{!-- Equipment Tab --}}
    <div class="tab equipment-tab" data-group="primary" data-tab="equipment">
      <div class="equipment-top-row">
        <div class="stats-block">
          <span class="stat-label silver-label">{{ localize "PB.Silver" }}</span>
          <input class="stat-input silver-input" name="data.silver" type="number" value="{{data.data.silver}}" data-dtype="Number" />
        </div>
        <div class="carry-block">
          <div class="stats-block">
            <span class="stat-label">{{ localize "PB.Carrying" }}</span>
            <span class="stat-value">{{data.data.dynamic.carryingWeight}}</span>
            <span class="stat-separator">/</span>
            <span class="stat-value">{{data.data.dynamic.carryingCapacity}}</span>
          </div>
          <div class="stat-rule {{ifPrint data.data.dynamic.encumbered 'encumbered'}}">
            {{#if data.data.dynamic.trackCarryingCapacity}} {{localize 'PB.CarryingRule'}} {{else}} {{localize 'PB.CarryingRuleNoPenalty'}} {{/if}}
          </div>
        </div>
      </div>
      <ol class="items-list equipment-list">
        {{> "systems/pirateborg/templates/actor/common/actor-equipment-list.html"}}
      </ol>
    </div>
  </section>
</form>
